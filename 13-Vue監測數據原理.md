# Vue 監測數據原理

我們知道當數據改動，Vue 的頁面，監視屬性，計算屬性，甚至開發者工具都能夠監測到。

### 原理

Vue 會對開發者編寫的 data 物件進行加工 (數據劫持) ，使原始物件轉為帶有 getter & setter 的物件，再放入 vm.\_data 中 (後續會再做數據代理等操作)。

1. 編寫 data
2. 加工 data
3. 放入 vm.\_data

為甚麼加上 getter & setter ?

1. 操作數據代理
2. `重要`: 做數據監聽 (達到響應式)

當數據發生改動，setter 會被調用，就可以做出一系列頁面改動等操作 (達到監聽的效果)。

### Vue 監視物件

當數據中物件的屬性值發生改動，Vue 也可以監測的到 (Vue 實現遞歸)。

例: a, b, c, d 發生改動均會被監測。

```js
const vm = new Vue({
  el: "#root",
  data: {
    a: 1,
    b: {
      c: 2,
      d: 3,
    },
  },
});
```

### 題外話: Vue.set()

在某些情況下，我們無法在配置 data 物件時就知道所有的數據，可能是用戶輸入，需要動態新增數據 (vm.\_data 或數據代理)。

我們無法直接透過屬性指派設置數據，因為 Vue 管理的數據是基於 getter & setter，而非普通的屬性。

使用 Vue.set():

```js
Vue.set(vm._data.student, "sex", "M");
```

or

```js
Vue.set(vm.student, "sex", "M");
```

也可以使用實例物件上 vm.$set() 方法達成一樣的工作。

注意: 不能直接在 vm 或 vm.\_data 新增屬性。

### Vue 監測 Array

Vue 並沒有為 Array 的元素配置 getter & setter。故 Array 中的內容並沒辦法監測。

然而，Vue 提供了兩個解決方案:

1.當陣列調用會就地改變自身的方法時 (如 pop, push) ，會被 Vue 監測到。 2. 使用 Vue.set()

其他情況請將改變的陣列替換原本的陣列，以達到更新屬性值的效果 (使用物件監測)。

就地改變方法:

- push()
- pop()
- shift()
- unshift()
- splice()
- sort()
- reverse()

- 一般情況是不被監測的
- 就地改變陣列方法可被監測
- 使用 Vue.set() 可被監測
- 直接替換原陣列使屬性被監測

原理: Vue 包裝了陣列方法。

### 總結

- 一般的數據: 可被監測改動，不得新增。
- 物件屬性值: 可被監測改動，透過 Vue.set() 新增。
- 陣列元素值: 不可被監測改動除非使用特殊方法或 Vue.set()，可使用特殊方法或 Vue.set() 新增。
